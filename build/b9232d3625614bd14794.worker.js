!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="./",r(r.s=3)}([function(e,t,r){"use strict";(function(e){t.a={sanitize:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},copyOptions:function(e){var t,r={};for(t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r},ensureFlagExists:function(e,t){e in t&&"boolean"===typeof t[e]||(t[e]=!1)},ensureSpacesExists:function(e){"spaces"in e&&("number"===typeof e.spaces||"string"===typeof e.spaces)||(e.spaces=0)},ensureKeyExists:function(e,t){e+"Key"in t&&"string"===typeof t[e+"Key"]||(t[e+"Key"]=t.compact?"_"+e:e)},getCommandLineHelp:function(e,t,r){var n="Usage: "+e+t.reduce((function(e,t){return e+" <"+t.arg+">"}),"")+" [options]\n";return t.forEach((function(e){n+="  <"+e.arg+">"+Array(20-e.arg.length).join(" ")+e.desc+"\n"})),n+="\nOptions:\n",r.forEach((function(e){n+="  --"+e.arg+Array(20-e.arg.length).join(" ")+e.desc+"\n"})),n},mapCommandLineArgs:function(t,r){var n,i,s={},a=2;for(n=0;n<t.length&&(a<e.argv.length&&"-"!==e.argv[a].substr(0,1)&&"JASMINE_CONFIG_PATH=./jasmine.json"!==e.argv[a]);n+=1)s[t[n].option]=e.argv[a++];for(;a<e.argv.length;a+=1){for(i=0;i<r.length&&(r[i].alias!==e.argv[a].slice(1)&&r[i].arg!==e.argv[a].slice(2));i+=1);if(i<r.length)switch(r[i].type){case"file":case"string":case"number":a+1<e.argv.length&&(a+=1,s[r[i].option]="number"===r[i].type?Number(e.argv[a]):e.argv[a]);break;case"flag":s[r[i].option]=!0}}return s}}}).call(this,r(2))},function(e,t,r){"use strict";e.exports=function(){if(!this)return null;var e,t,r,n,i,a,l=s,c=s,f=s,d=s,p=s,g=!1,m=!1,y=!1,h=!1,b=!1,x=!1,v=null,k=!1,K={xmlns:void 0},O="";this.on=function(i,a){if("function"===typeof a||null===a)switch(i){case"startNode":c=a||s;break;case"textNode":l=a||s;break;case"endNode":f=a||s;break;case"error":p=a||s;break;case"cdata":d=a||s;break;case"unknownNS":n=a,h=!!a;break;case"attention":r=a,y=!!a;break;case"question":t=a,m=!!a;break;case"comment":e=a,g=!!a}},this.ns=function(e,t){if(!e||"string"!==typeof e||!t)return this;var r,n,s,o={};for(s in t)"string"===typeof(n=t[s])&&(e===n&&(r=!0),o[s]=n);return r&&(i=e,x=!0,a=o),this},this.parse=function(e){if("string"===typeof e)return v=null,O=e,x?(K={xmlns:i},L(),K=!1):L(),k=!1,w=!0,O="",v},this.stop=function(){k=!0};var w,E=0,P=0,A="",T=0;function S(){if(null!==w)return w;for(var e,t,r,i,s,l,c,f,d,p,g=x&&b?[]:null,m=T,y=A,v=y.length,k={};m<v;m++)if(!(32===(d=y.charCodeAt(m))||d<14&&d>8)){if((d<65||d>122||d>90&&d<97)&&95!==d&&58!==d)return w=!1;for(p=m+1;p<v;p++)if(!((d=y.charCodeAt(p))>96&&d<123||d>64&&d<91||d>47&&d<59||45===d||95===d)){if(61!==d)return w=!1;break}if(f=!0,"xmlns:xmlns"===(c=y.substring(m,p)))return w=!1;if(34===(d=y.charCodeAt(p+1)))p=y.indexOf('"',m=p+2);else{if(39!==d)return w=!1;p=y.indexOf("'",m=p+2)}if(-1===p)return w=!1;if(p+1<v&&((d=y.charCodeAt(p+1))>32||d<9||d<32&&d>13))return w=!1;if(s=y.substring(m,p),m=p+1,x)if(b){if(null!==(i="xmlns"!==c?120===c.charCodeAt(0)&&"xmlns:"===c.substr(0,6)?c.substr(6):null:"xmlns")){l=a[o(s)],h&&!l&&(l=n(s)),l?K[i]!==l&&(r||(K=u(K),r=!0),K[i]=l):K[i]&&(r||(K=u(K),r=!0),K[i]=!1),k[c]=s;continue}g.push(c,s)}else-1!==(d=c.indexOf(":"))?(t=K[c.substring(0,d)])&&(k[(t=K.xmlns===t?c.substr(d+1):t+c.substr(d))+c.substr(d)]=s):k[c]=s;else k[c]=s}if(!f)return w=!0;if(b)for(e=K.xmlns,m=0,v=g.length;m<v;m++)-1===(d=(c=g[m++]).indexOf(":"))?k[c]=g[m]:(t=K[c.substring(0,d)])&&(k[t=e===t?c.substr(d+1):t+c.substr(d)]=g[m]);return w=k}function C(){return O.substring(E,P+1)}function L(){for(var n,i,s,a,u,h,L,N,_=[],j=[],F=!1,I=!1,M=0,D=0,U=0;-1!==M;){if(N=U>0,-1===(D=60===O.charCodeAt(M)?M:O.indexOf("<",M)))return j.length?void p(v="end file"):void 0;if(M!==D&&!N&&(l(O.substring(M,D),o),k))return;if(33!==(a=O.charCodeAt(D+1)))if(63!==a){if(-1==(M=O.indexOf(">",D+1)))return void p(v="...>");if(w=!0,47===a){if(F=!1,I=!0,!j.length)return void p(v="close tag, requires open tag");if(s=D+2+(n=L=j.pop()).length,O.substring(D+2,s)!==n)return void p(v="close tag, not equal to the open tag");for(;s<M;s++)if(!(32===(a=O.charCodeAt(s))||a>8&&a<14))return void p(v="close tag")}else{if(47===O.charCodeAt(M-1)?(n=L=O.substring(D+1,M-1),F=!0,I=!0):(n=L=O.substring(D+1,M),F=!0,I=!1),!(a>96&&a<123||a>64&&a<91||95===a||58===a))return void p(v="first char nodeName");for(s=1,i=n.length;s<i;s++)if(!((a=n.charCodeAt(s))>96&&a<123||a>64&&a<91||a>47&&a<59||45===a||95===a)){if(32===a||a<14&&a>8){L=n.substring(0,s),w=null;break}return void p(v="invalid nodeName")}I||j.push(L)}if(x){if(N){I?F||0===--U&&(K=_.pop()):U+=1,M+=1;continue}if(u=K,I||_.push(K),F&&!0!==w&&(b=-1!==n.indexOf("xmlns",s))&&(T=s,A=n,S(),b=!1),-1!==(a=L.indexOf(":"))?(h=K[L.substring(0,a)],L=L.substr(a+1)):h=K.xmlns,!h){I?K=F?u:_.pop():(U=1,w=!0),M+=1;continue}L=h+":"+L}if(E=D,P=M,F){if(T=s,A=n,c(L,S,o,I,C),k)return;w=!0}if(I){if(f(L,o,F,C),k)return;x&&(K=F?u:_.pop())}M+=1}else{if(-1===(M=O.indexOf("?>",D)))return void p(v="...?>");if(m&&(t(O.substring(D,M+2)),k))return;M+=2}else{if(91===(a=O.charCodeAt(D+2))&&"CDATA["===O.substr(D+3,6)){if(-1===(M=O.indexOf("]]>",D)))return void p(v="cdata");if(!N&&(d(O.substring(D+9,M),!1),k))return;M+=3;continue}if(45===a&&45===O.charCodeAt(D+3)){if(-1===(M=O.indexOf("--\x3e",D)))return void p(v="expected --\x3e");if(g&&!N&&(e(O.substring(D+4,M),o),k))return;M+=3;continue}if(-1===(M=O.indexOf(">",D+1)))return void p(v='expected ">"');if(y&&!N&&(r(O.substring(D,M+1),o),k))return;M+=1}}}};var n=String.fromCharCode,i={constructor:!1,propertyIsEnumerable:!1,toLocaleString:!1,hasOwnProperty:!1,isPrototypeOf:!1,toString:!1,valueOf:!1,quot:'"',QUOT:'"',amp:"&",AMP:"&",nbsp:"\xa0",apos:"'",lt:"<",LT:"<",gt:">",GT:">",copy:"\xa9",laquo:"\xab",raquo:"\xbb",reg:"\xae",deg:"\xb0",plusmn:"\xb1",sup2:"\xb2",sup3:"\xb3",micro:"\xb5",para:"\xb6"};function s(){}function a(e,t,r,s){return s?i[s]||"\x01":n(t||parseInt(r,16))}function o(e){return(e=""+e).length>3&&-1!==e.indexOf("&")&&(-1!==e.indexOf("&quot;")&&(e=e.replace(/&quot;/g,'"')),-1!==e.indexOf("&gt;")&&(e=e.replace(/&gt;/g,">")),-1!==e.indexOf("&lt;")&&(e=e.replace(/&lt;/g,"<")),-1!==e.indexOf("&")&&(e=e.replace(/&#(\d+);|&#x([0123456789abcdef]+);|&(\w+);/gi,a))),e}function u(e){var t={};for(var r in e)t[r]=e[r];return t}},function(e,t){var r,n,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"===typeof setTimeout?setTimeout:s}catch(e){r=s}try{n="function"===typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,l=[],c=!1,f=-1;function d(){c&&u&&(c=!1,u.length?l=u.concat(l):f=-1,l.length&&p())}function p(){if(!c){var e=o(d);c=!0;for(var t=l.length;t;){for(u=l,l=[];++f<t;)u&&u[f].run();f=-1,t=l.length}u=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new g(e,t)),1!==l.length||c||o(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";r.r(t);var n,i,s=r(1),a=r.n(s),o=r(0);function u(e,t,r){if(r.compact)i[r[e+"Key"]]=(i[r[e+"Key"]]?i[r[e+"Key"]]+"\n":"")+t;else{i[r.elementsKey]||(i[r.elementsKey]=[]);var n={};n[r.typeKey]=e,n[r[e+"Key"]]=t,r.addParent&&(n[r.parentKey]=i),i[r.elementsKey].push(n)}}function l(e,t){var r,s;"object"===typeof e&&(a=e.attributes,e=e.name);var a=t();if(n.trim&&a&&"object"===typeof a)for(r in a)a.hasOwnProperty(r)&&(a[r]=a[r].trim());if(n.compact){if(s={},!n.ignoreAttributes&&a&&"object"===typeof a&&Object.keys(a).length)for(r in s[n.attributesKey]={},a)a.hasOwnProperty(r)&&(s[n.attributesKey][r]=a[r]);s[n.parentKey]=i,e in i?(i[e]instanceof Array||(i[e]=[i[e]]),i[e].push(s)):i[e]=s,i=s}else i[n.elementsKey]||(i[n.elementsKey]=[]),(s={})[n.typeKey]="element",s[n.nameKey]=e,!n.ignoreAttributes&&a&&Object.keys(a).length&&(s[n.attributesKey]=a),s[n.parentKey]=i,n.alwaysChildren&&(s[n.elementsKey]=[]),i[n.elementsKey].push(s),i=s}function c(e){n.ignoreText||e.trim()&&(n.trim&&(e=e.trim()),n.nativeType&&(e=function(e){var t=Number(e);if(!isNaN(t))return t;var r=e.toLowerCase();return"true"===r||"false"!==r&&e}(e)),n.sanitize&&(e=o.a.sanitize(e)),u("text",e,n))}function f(e){n.ignoreComment||(n.trim&&(e=e.trim()),n.sanitize&&(e=o.a.sanitize(e)),u("comment",e,n))}function d(e){var t=i[n.parentKey];n.addParent||delete i[n.parentKey],i=t}function p(e){n.ignoreCdata||(n.trim&&(e=e.trim()),u("cdata",e,n))}function g(e){e.note=e}var m=function(e,t){var r=new a.a,s={};if(i=s,n=function(e){return n=o.a.copyOptions(e),o.a.ensureFlagExists("ignoreDeclaration",n),o.a.ensureFlagExists("ignoreAttributes",n),o.a.ensureFlagExists("ignoreText",n),o.a.ensureFlagExists("ignoreComment",n),o.a.ensureFlagExists("ignoreCdata",n),o.a.ensureFlagExists("compact",n),o.a.ensureFlagExists("alwaysChildren",n),o.a.ensureFlagExists("addParent",n),o.a.ensureFlagExists("trim",n),o.a.ensureFlagExists("nativeType",n),o.a.ensureFlagExists("sanitize",n),o.a.ensureKeyExists("declaration",n),o.a.ensureKeyExists("attributes",n),o.a.ensureKeyExists("text",n),o.a.ensureKeyExists("comment",n),o.a.ensureKeyExists("cdata",n),o.a.ensureKeyExists("type",n),o.a.ensureKeyExists("name",n),o.a.ensureKeyExists("elements",n),o.a.ensureKeyExists("parent",n),n}(t),r.on("startNode",l),r.on("endNode",d),r.on("textNode",c),r.on("cdata",p),r.on("comment",f),r.on("error",g),r.parse(e),s[n.elementsKey]){var u=s[n.elementsKey];delete s[n.elementsKey],s[n.elementsKey]=u,delete s.text}return i=null,s};self.addEventListener("message",(function(e){const{type:t,url:r,satName:n,filterDate:i}=e.data;switch(t){case"downloadAndParseKmls":(async function(t,r,n){const{err:i,body:s}=await async function(e){let t=null,r=null;try{t=await fetch(e)}catch(n){return{err:"Unable to fetch file: "+e,body:r}}if(!t.ok&&0!==t.status)return{err:"Unable to fetch file: "+e,body:r};try{r=await t.text()}catch(n){return{err:"Unable to fetch file: "+e,body:r}}return{err:null,body:r}}(t);if(i)return{err:i,shapes:null};const a=function(t,r,n){let i=null;try{const e=m(r,{compact:!0,spaces:4});i=y.parse(e);const s=t.includes("s2"),a=new Date(n);i=i.filter(e=>{const t=new Date(e.timeSpan.end)>=a;return s?t&&"NOBS"===e.extendedData.Mode&&"NOMINAL"===e.extendedData.Timeliness:t})}catch(e){console.error("KMLWorker - parse error",e),i=null}return i}(r,s,n)||s;return{err:i,shapes:a}})(r,n,i).then(({err:e,shapes:i})=>{self.postMessage({type:t,satName:n,url:r,shapes:i,err:e,workerId:"kmlWorker"})});break;default:self.postMessage({type:t,satName:n,url:r,shapes:null,err:"Unknown action type: "+t,workerId:"kmlWorker"})}}));const y={parse(e){const t=e.kml.Document,r=t.Folder;if(!r)return null;const n=t.Style,i=t.StyleMap,s=[];if(this.getPlacemarks(r,s),0===s.length)return null;const a=this.parseStyles(n);return this.parseStyleMap(i,a),this.parsePlacemarks(s,a)},parseStyles:function(e){return e.map(e=>{const t=this.formatId(e._attributes.id);let r="ffffffff";return e.LineStyle&&e.LineStyle.color&&e.LineStyle.color._text&&(r=e.LineStyle.color._text),{id:t,color:r}})},parseStyleMap:function(e,t){if(!e)return;const r=t.map(e=>e.id),n=this.formatId(e._attributes.id),i=e.Pair.filter(e=>"normal"===e.key._text)[0],s=this.formatId(i.styleUrl._text),a=t[r.indexOf(s)].color||"ffffffff";t.push({id:n,color:a})},parsePlacemarks:function(e,t){const r=[];for(let n=0;n<e.length;n++){let i=e[n],s=this.parseStyleUrl(i.styleUrl),a={extendedData:this.parseExtendedData(i.ExtendedData),timeSpan:this.parseTimeSpan(i.TimeSpan),name:this.parseName(i.name),coordinates:this.parseCoordinates(i),color:this.matchStyle(t,s)};r.push(a)}return r},matchStyle:function(e,t){const r=e.filter(e=>e.id===t)[0];return r?r.color:"ffffffff"},parseCoordinates:function(e){let t;if(e.LinearRing&&e.LinearRing.coordinates)t=e.LinearRing.coordinates;else{if(!(e.Polygon&&e.Polygon.outerBoundaryIs&&e.Polygon.outerBoundaryIs.LinearRing&&e.Polygon.outerBoundaryIs.LinearRing.coordinates))return console.error("parseCoordinates - unsuported shape",e),[];t=e.Polygon.outerBoundaryIs.LinearRing.coordinates}return t._text.trim().replace(/\s+/g," ").split(" ").map(e=>{const t=e.split(",");return{latitude:+t[1],longitude:+t[0]}})},parseExtendedData:function(e){const t={},r=e.Data;for(let n=0;n<r.length;n++){let e=r[n],i=e._attributes.name,s="";e.value&&(s=e.value._text),t[i]=s}return t},parseTimeSpan:function(e){return{begin:e.begin._text,end:e.end._text}},parseName:function(e){return e._text},parseStyleUrl:function(e){return this.formatId(e._text)},formatId:e=>"#"===e[0]?e.slice(1):e,getPlacemarks(e,t){if(Array.isArray(e))for(let r=0,n=e.length;r<n;r++){let n=e[r];n&&(n.Placemark?this.addPlacemarks(n.Placemark,t):this.getPlacemarks(n,t))}else e&&e.Folder?this.getPlacemarks(e.Folder,t):e&&e.Placemark&&this.addPlacemarks(e.Placemark,t)},addPlacemarks(e,t){if(Array.isArray(e))for(let r=0,n=e.length;r<n;r++)e[r]&&t.push(e[r]);else e&&t.push(e)}}}]);
//# sourceMappingURL=b9232d3625614bd14794.worker.js.map